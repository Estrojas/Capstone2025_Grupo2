---
export const prerender = false;
import { ClientRouter } from "astro:transitions";

import { createServerSupabase } from "@/lib/supabase/supabaseServer";
const supabase = createServerSupabase({ request: Astro.request, cookies: Astro.cookies });

// Validar usuario verificado
const { data: userData, error: userErr } = await supabase.auth.getUser();
const user = userData?.user ?? null;

if (userErr) console.warn("[login] supabase.auth.getUser error:", userErr.message);
if (user) throw Astro.redirect("/");
---
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/img/icono.png" />
    <script is:inline src="/terceros/flowbite.min.js"></script>
    <link href="/terceros/flowbite.min.css" rel="stylesheet"/>
    <title>Admission Analytics</title>
    <ClientRouter />
</head>


<container title="Ingresar - DuocUC® Admission Analytics">

    <style is:global>
        @import "../../styles/login.css";
    </style>

    <div class="login-container">
        <!-- Fondo con imagen -->
        <div class="login-background"></div>
        
        <!-- Overlay oscuro -->
        <div class="login-overlay"></div>
        
        <!-- Card de Login -->
        <div class="login-card-wrapper">
            <div class="login-card">
                
                <!-- Logo o Título -->
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-white mb-2">DuocUC®</h1>
                    <p class="text-gray-300 text-sm">Admission Analytics</p>
                </div>

                <!-- Formulario -->
                <form id="login-form" action="/api/auth/login" class="space-y-5" method="post" autocomplete="on" novalidate>
                    <!-- Campo de Email -->
                    <div>
                        <label for="email" class="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                            Correo Electrónico
                        </label>
                        <input  type="email"  id="email" name="email"  placeholder="ejemplo@duocuc.cl" required  autocomplete="username"
                            class="w-full px-4 py-3 bg-gray-800/80 border border-gray-600 rounded-lg text-black placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"/>
                    </div>

                    <!-- Campo de Contraseña -->
                    <div>
                        <label for="password" class="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                            </svg>
                            Contraseña
                        </label>
                        <input  type="password"  id="password" name="password"  placeholder="••••••••" required  autocomplete="current-password"
                            class="w-full px-4 py-3 bg-gray-800/80 border border-gray-600 rounded-lg text-black placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"/>
                    </div>

                    <!-- Mensaje de Error -->
                    <div id="login-error" class="hidden opacity-0 translate-y-1 bg-red-500 border border-red-400 text-white text-sm rounded-md p-2 mt-2 transition-all duration-300 ease-in-out" >
                        <span id="error-message"></span>
                    </div>

                    <!-- Botón Ingresar -->
                    <button  type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 transform hover:scale-[1.02] active:scale-[0.98] shadow-lg">
                        Ingresar
                    </button>
                </form>
                

                <!-- Footer -->
                <div class="mt-6 text-center text-gray-400 text-xs">
                    <p>© 2025 DuocUC®. Todos los derechos reservados.</p>
                </div>
            </div>
        </div>
    </div>
</container>

<script type="module" src="/js/login.client.js"></script>
